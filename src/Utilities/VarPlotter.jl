module VarPlotter

export plot_thrust_magnitude, plot_angular_velocity_magnitude, plot_vector_component

using Plots
using LinearAlgebra
using CairoMakie

function plot_thrust_magnitude(U::Matrix{Float64}, params::Dict)
    # Compute thrust magnitude
    thrust_magnitude = [norm(U[:, i]) for i in 1:size(U, 2)]
    N = size(U, 2)
    time_steps = 1:N

    # Create a figure and axis
    fig = Figure(size = (800, 600))
    ax = Axis(fig[1, 1], xlabel = "Time Step", ylabel = "Thrust Magnitude")

    # Plot thrust magnitude
    lines!(ax, time_steps, thrust_magnitude, label = "Thrust Magnitude", color = :blue, linewidth = 2)

    # Plot max and min thrust as horizontal lines
    hlines!(ax, [params["T_max"]], label = "Max Thrust", color = :red, linestyle = :dash)
    hlines!(ax, [params["T_min"]], label = "Min Thrust", color = :green, linestyle = :dash)

    # Add legend and display the plot
    axislegend(ax)
    display(fig)
end

function plot_angular_velocity_magnitude(X::Matrix{Float64}, params::Dict)
        # Compute thrust magnitude
        N = size(X, 2)
        angular_velocity = [norm(X[12:14, i]) for i in 1:N]
        time_steps = 1:N
    
        # Create a figure and axis
        fig = Figure(size = (800, 600))
        ax = Axis(fig[1, 1], xlabel = "Time Step", ylabel = "Angular Velocity Magnitude")
    
        # Plot thrust magnitude
        lines!(ax, time_steps, angular_velocity, label = "Angular Velocity Magnitude", color = :blue, linewidth = 2)
    
        # Plot max and min thrust as horizontal lines
        hlines!(ax, params["rad_omega_max"], label = "Max Angular Velocity", color = :red, linestyle = :dash)
        # Add legend and display the plot
        axislegend(ax)
        display(fig)
end

function plot_vector_component(X::Matrix{Float64}, index::Int, params::Dict, title::String)
    # plot one state vector component for all time
    N = size(X, 2)
    component = [X[index, i] for i in 1:N]
    time_steps = 1:N

    # Create a figure and axis
    fig = Figure(size = (800, 600))
    ax = Axis(fig[1, 1], xlabel = "Time Step", ylabel = "Component Value", title = title)

    # Plot component value
    lines!(ax, time_steps, component, label = "Component Value", color = :blue, linewidth = 2)

    # Add legend and display the plot
    axislegend(ax)
    display(fig)
end

end  # module VarPlotter

using .VarPlotter  

# Example usage: commented out gimbal angle constraint
X = [30000.0 29733.33935323295 29466.671368482275 29200.00358229881 28933.336778266097 28666.671016724307 28400.005463249017 28133.339641064253 27866.67373374671 27600.007378849277 27333.341002393012 27066.674597894962 26800.00805670813 26533.341527201188 26266.675301017804 26000.009458546552 25733.34367864809 25466.677014139277 25200.010510065727 24933.34364926717 24666.674624246396 24400.00930215658 24133.34266369511 23866.676764795735 23600.011449623118 23333.347571283728 23066.769149148753 22963.377498124595 22858.6444182821 22753.921520642063; 200.0 193.3332533085509 186.66664203602483 179.99994403236585 173.33304652656213 166.66650160147879 159.99950351686147 153.3330164155482 146.66652927225692 140.00034709850374 133.333019423191 126.66726295623005 120.00087169715405 113.33307438268068 106.66529446790406 99.99950514728566 93.33309215284339 86.6661979581408 80.0007179908535 73.33341555886015 66.66389722152577 59.99988686401861 53.33300378449757 46.663760776553715 39.99760776563925 33.32469505657689 26.664598094523317 19.999632748163844 13.333099314414246 0.0; 200.0 192.19614474083676 186.66698552180472 180.00014140155199 173.33328198169187 166.66669617018016 159.99961221003534 153.33317276950066 146.66664004550003 140.00016923500863 133.3331642223452 126.666803078115 120.00019909833607 113.16772864727135 106.6663586781847 100.00031156074171 93.33334080871386 86.66656842822728 79.99939244193284 73.33328719322726 66.66665088396799 59.99963332511015 53.332985961145944 46.6516894865504 39.9975610624824 33.331885200138125 26.66600900000828 19.999464231503794 13.332967855094719 0.0; 500.0 483.3334145892806 466.6668040035035 450.00006163158645 433.33334807481566 416.66669404693766 400.0000190025514 383.33313373159143 366.66242185358817 349.99997398132325 333.33246325394015 316.66696530512127 299.99970846469046 283.3339821950624 266.6667378893554 250.00046329028189 233.33291893105934 216.66680079381672 200.0001036973615 183.33238462195655 166.6665137558019 149.9993534283715 133.32914092311134 116.6658247338798 99.99020765423992 83.32102933859038 66.66645134006215 49.99999711987021 33.33323518140096 0.0; -50.0 -14.114129060000458 -14.952879578674843 -14.566302025949186 -14.163006536337196 -13.873245079827953 -13.642085890184013 -13.414210465861222 -13.20612983514481 -13.10962029138581 -13.08267386292129 -13.05954557759544 -13.031752935362642 -13.010844095251898 -12.894671370761829 -13.439399294461055 -13.715218940309144 -13.900685384011412 -13.83171896392663 -14.03532863302006 -13.804367341137539 -13.68216924134481 -13.333401124914701 -13.135698564038861 -13.091015436604883 -13.031401615809068 -12.891285725238216 -12.75112721751033 -12.564281407050355 0.0; -50.0 -11.430989416704415 -10.470537650713315 -10.918271162180686 -11.363692684095435 -11.687335877882958 -11.965216569689503 -12.243698177641301 -12.52718293831402 -12.718186322529142 -12.85968572307773 -13.005491665812988 -13.13711355840398 -13.364338421609538 -13.769929990176266 -14.44518464516948 -14.3876680982457 -14.308407983466772 -14.607200700354738 -14.828406451581035 -14.983170219814555 -14.93770816661256 -13.61790084863973 -14.125318116082331 -14.075202831502116 -14.11399710774407 -14.14981446125046 -14.200556971823833 -14.210946182329891 0.0; -100.0 -82.63081859821939 -73.88288513117962 -64.89498050758756 -55.78074667835697 -48.677877608681165 -43.632921578958715 -38.48803719855753 -33.30814751024242 -30.187386746811214 -34.02381548470015 -33.10117574506885 -32.77636749868144 -31.680238413067613 -52.25604444098717 -51.563771750560626 -44.0345734162248 -43.05515438337799 -41.16082542479367 -39.826831932402094 -36.66135307444386 -33.50126660296973 -32.564482960726316 -33.89685296625322 -30.32163758186634 -31.722795525990765 -27.520225471749644 -20.05468614859044 -12.251296587285095 -5.0; 1.0 0.9999995259138217 1.0006948949431589 1.0004189374534178 1.0000036393483 0.9999998351675785 0.9999996716065027 0.9999997570563934 0.9999997805198504 0.9999997377884284 0.9999998069211458 0.9999997234889619 0.9999997487671877 0.9999986564111012 0.9999577586410595 0.9999993863534016 0.9999739475255325 1.0000269879916388 0.9999999801089245 0.9999999753835382 0.9999999173478216 0.9999998953790694 0.9999998014239821 0.999999966558299 0.999999993888494 1.0000000004940404 0.999999993842259 1.0000000376527538 1.0000000879647786 1.0; 0.0 -5.7383995187232306e-8 -7.015676530452008e-8 -2.2936788850888488e-7 -1.7964275675810333e-7 -2.140106695368798e-7 -1.3075650010980273e-7 -1.0942165298042107e-7 -1.0785251003560376e-7 -5.369166211672877e-8 -7.699421313354295e-8 -4.1591735823872483e-8 -4.455662607176169e-8 -2.8320729909016988e-8 -5.824170452255776e-8 -8.300956670253451e-8 -9.613752091927049e-8 -1.6024095802314432e-7 -1.9130200498812025e-7 -1.910207090958255e-7 -1.952669736119045e-7 -2.993332233445882e-7 -9.912175625229155e-8 1.3378369665367476e-8 9.005367160404408e-8 1.1577946788836778e-7 2.603100642304882e-7 -9.598618068773496e-7 6.126265238904425e-5 0.0; 0.0 4.0456694117476666e-7 3.0390036639858175e-7 6.352063663781161e-8 3.1104728906903247e-8 -3.646375950829471e-8 -1.1502230190041118e-8 -7.594038731749477e-10 -1.4954453868708525e-8 2.619825626442348e-8 -2.056670107028425e-8 -3.974944303785e-9 -3.4826050985960525e-8 -4.9867363124731444e-8 -1.2355598876016112e-7 -1.489626191433197e-7 -1.2134542302042231e-7 -1.472955455776212e-7 -1.4539890035253858e-7 -1.417258138574636e-7 -1.2189607448720004e-7 4.5410703795672234e-8 5.268854713357432e-8 1.075282853858644e-8 9.75346803095761e-8 2.002321132705497e-7 4.488952143629291e-7 1.430687554364766e-7 -0.00019937670309967096 0.0; 0.0 -7.254388190523944e-6 5.090728981325663e-8 2.507606574569388e-7 2.6209136309497146e-7 2.6206957558283465e-7 2.6769551546036906e-7 2.71853177334642e-7 2.754800475556238e-7 2.682295534682128e-7 2.648796583921991e-7 2.668249338803112e-7 2.428451572575243e-7 1.2405900346516227e-7 2.925625062743818e-7 4.058025030390196e-7 2.780245444295176e-7 2.7861192721388607e-7 2.8771306180064674e-7 2.9188720602431496e-7 2.802368722303811e-7 2.891086288629834e-7 2.682506517762497e-7 2.5514621160740555e-7 2.636566468469661e-7 2.6186646931328403e-7 2.4064382889145695e-7 2.1275996346662445e-7 1.3884085864431724e-7 0.0; 0.174533 -0.022967705319892673 0.1061646824730218 0.10615862124994635 0.10612465422413209 0.10607133659922141 0.10598851440919788 0.10586864778172611 0.10575806902231477 0.10565605382387133 0.10543868742222173 0.10505607149586638 0.10469705590185896 0.09884075152249494 0.05250366973660903 0.011716400781274672 0.010921942445278887 0.007396672604791377 0.0030530399350325865 0.0015056479503456899 0.0013626801529511567 0.0013228130858848886 0.0013521132121425694 0.0013706671269630988 0.0013150757918367617 0.0012462090612643806 0.0012267560938923339 0.0007706441589121482 5.22506414313284e-6 0.0; 0.174533 -0.03131815830370499 0.08112716135099873 0.08106971259829265 0.07880374092136577 0.0757947019412697 0.07225937638842339 0.06752922657785376 0.06447045490148184 0.06211783082082434 0.06070214483268899 0.060529682843657895 0.06049118926766539 0.06049237055822232 0.060514792586879196 0.06054504800393801 0.060572179681813054 0.06058895716189738 0.060584996315917294 0.0605104827357934 0.056868269928976645 0.05235167779738248 0.041387831104152895 0.031095276407242523 0.030087033736009516 0.029003775350631145 0.023271208825768497 0.01741319571308253 0.006598412804386555 0.0; 0.0 6.2896009760861e-8 1.759831004795861e-8 1.653646739107886e-8 9.608456944764999e-9 4.016953346931622e-9 4.143508698027633e-10 -1.8193386422756055e-9 -3.1546769485316663e-9 -5.439368589683794e-9 -8.577792173603504e-9 -9.994827524207605e-9 -1.8019891383200505e-8 -5.5978151353290234e-8 -5.0073837977695846e-8 -1.4815631416483311e-8 -1.339170235481557e-8 -1.2367006548143063e-8 -9.226065437261225e-9 -5.340151056545278e-9 -3.4624542917650186e-9 -6.286383785833778e-10 -1.908123509943742e-9 -6.580977730298837e-9 -7.05067278278785e-9 -6.532436261635925e-9 -4.70663644750558e-9 -7.9459786330421e-9 5.107150304024041e-10 0.0]
U = [351654.28005253023 -124233.19984540879 11.001289029354721 53.90928816975937 2451.1706494855935 872.7512782653225 3034.9209237042623 2191.2270678130826 1189.0270850793972 1411.131803177455 155.01097309406285 37.10891592332772 7.305281908232537 -5.832512070027571 -13.63321137150893 -14.534858146408661 -10.16183819837626 -3.782036862185 12.251669068263617 72.26182116014792 3953.5870732787075 1038.4430350474609 11076.39714909688 297.312725186249 819.2341509099004 377.46840533989325 5376.946034873911 1130.929382636266 10854.478511524132 -2738.186861816623; -360846.6051230016 142654.17436668935 2.4263582999395608 -11.315599887107053 -29.07343337641351 -31.916579624668554 -62.05942201682593 -71.55489024302794 -53.13062846736745 -60.50759730832603 -180.71126027391566 -244.25466085433447 -155.75524498057268 -6316.759491839954 -44877.06282478785 -184.31661996066578 -695.9891028885836 -3199.449442263265 -1601.1669410754043 -108.56321715926983 -51.22310598736179 5.294291086008984 23.309905993469293 -4.905187819429395 -59.30062207625108 -19.481582893509106 -11.463832606206086 -491.14511034346873 -390.4862379485673 20.110099889671638; 621384.2168228076 777323.8054720697 800004.389616279 799998.8999102027 799936.7210054691 560019.2570671677 560004.3353963004 559989.5296439516 559790.6348497559 320061.15352922323 320029.3434737767 320030.329218522 320037.0210353366 320038.7136208844 320034.9416740631 320034.66468332155 320022.4498709245 320094.2556690118 320242.9691381578 320295.43201853096 557979.7328952892 320179.757347199 320025.3105671114 320020.38355368195 320017.4481122337 320021.93113549706 545514.2247932932 559987.9628244471 560007.4691809056 560014.1009845004]
params = Dict("T_max" => 800000, "T_min" => 320000, "rad_omega_max" => 1.5708)
plot_angular_velocity_magnitude(X, params)
plot_thrust_magnitude(U, params)
plot_vector_component(X, 1, params, "Mass")
plot_vector_component(X, 2, params, "X Position")
plot_vector_component(X, 3, params, "Y Position")
plot_vector_component(X, 4, params, "Z Position")
plot_vector_component(X, 5, params, "X Velocity")
plot_vector_component(X, 6, params, "Y Velocity")
plot_vector_component(X, 7, params, "Z Velocity")
plot_vector_component(X, 8, params, "q0")
plot_vector_component(X, 9, params, "q1")
plot_vector_component(X, 10, params, "q2")
plot_vector_component(X, 11, params, "q3")
plot_vector_component(X, 12, params, "Angular Velocity X")
plot_vector_component(X, 13, params, "Angular Velocity Y")
plot_vector_component(X, 14, params, "Angular Velocity Z")


